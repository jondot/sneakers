<!doctype html>
<html>
<head>
<link href='/favicon.ico' rel='icon' type='image/x-icon'/>
<meta charset="utf-8" />
<meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
<title>Sneakers Blog  - Modular Workers for Easier Testing and Development</title>
<link href='http://fonts.googleapis.com/css?family=Roboto:400,300,700' rel='stylesheet' type='text/css'>

  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml" />
  <link href="../../../../stylesheets/app.css" rel="stylesheet" type="text/css" />

</head>
<body>
  
<header class="navigation">
  <div class="navigation-wrapper">
    <div class="navigation-content">
      <div style="padding:0px">
        <a href="http://sneakers.io" class="logo">
          <img src="../../../../images/main_logo.png" alt="Logo Image">
        </a>
      </div>
      <a href="" class="navigation-menu-button" id="js-mobile-menu">MENU</a>
      <div class="nav">
        <ul id="navigation-menu">
          <li class="nav-link "><a href="http://sneakers.io">Home</a></li>
          <li class="nav-link selected"><a href="http://sneakers.io/blog">Blog</a></li>
          <li class="nav-link"><a href="https://github.com/jondot/sneakers/wiki">Docs</a></li>
          <li class="nav-link">
          <a class="fork" href="https://github.com/jondot/sneakers"><i class="fa fa-github"></i> Fork on Github &rarr;</a></li>
        </ul>
      </div>
    </div>
  </div>
</header>


  <div class="blog-content">
    <main class="blog-main">
          <h1 class="article-title"><a href="modular-workers.html">Modular Workers for Easier Testing and Development</a></h1>
<div class="article_head">
  <div class="article_head-author">
    <img src="http://www.gravatar.com/avatar/7bab8ed9cad2d098076b61b7cc3b8030?s=32.jpg" alt=""/>
    <a href="http://twitter.com/jondot">Dotan Nahum</a>, Dec  4
  </div>
</div>


      <p>A background worker in the Ruby world can find its place either assiting a
Rails stack, or having a life of its own.</p>

<p>I argue that in either case, giving a worker a life of its own will be highly productive in the long run. Having
the worker modeled as a stand-alone library or a gem, a module if you will, is even more productive.</p>

<h4 id="whats-a-modular-worker">What's a Modular Worker?</h4>

<p>Simply put, a modular worker is a worker that is a library or a project of its own. You can export it to a gem and then depend on it,
and in turn, it can declare what it depends on - like any other software project.</p>

<p>A modular worker is a first-class software project, that can be iterated upon independently and quickly.</p>

<p><img alt="" src="../../../../images/blog/modular_workers-acmeworker.png" /></p>

<p>One strategy of creating a modular worker architecture is to extract all your worker code into 2 projects.</p>

<ol>
  <li>Shell worker project</li>
  <li>Actual worker logic project</li>
</ol>

<p>Illustrated above - is a shell project, where you wire up your worker logic against an actual worker logic project. Within such a shell project,
you would set up:</p>

<ul>
  <li>Deployment</li>
  <li>Runner strategy (foreman/upstart/runit, supporting scripts)</li>
  <li>Supporting configuration - logging, monitoring</li>
  <li>Integration tests and harnesses with real data</li>
  <li>Dependency and wiring up of the worker into the actual logic code that is <code>AcmeCorp::Handler</code></li>
</ul>

<p>This frees the core <code>AcmeCorp::Handler</code> project to be:</p>

<ul>
  <li>Ignorant of "operational" concerns, with less operational dependencies</li>
  <li>A simple Ruby project, familiar to any developer</li>
  <li>Rapidly developed and tested - you pick your workflow</li>
  <li>A composable gem, that is fully versioned</li>
</ul>

<p>With this layout, 90% of the time - you'll be maintaining the actual logic of handling messages, while being assured 
that other concerns like deployment, integration tests, etc. are just taking 10% of your time and can also
be maintained by other non-domain relevant members of the team (devops?).</p>

<p>To recap, now you'll be treating workers like so:</p>

<ul>
  <li>Worker Shell aspects - deployment, monitoring etc. are a repo, and a gem, maintained separately.</li>
  <li>Business aspects - logic, message handling etc. are a repo, and a gem, maintained separately.</li>
  <li>The shell can be reused.</li>
  <li>The whole system is a set of gems, like any other project.</li>
  <li>The whole system is released and versioned as a first-class software product.</li>
</ul>

<h4 id="sneakers-does-modular-workers-by-default">Sneakers Does Modular Workers by Default</h4>

<p>Using Sneakers, you're already doing this without noticing. If you'll take a look at Sneakers' test suite, you'll find that testing
is easy and simple, and that workers are modular enough that you can pack any of them into gems easily.</p>

<p>In fact I mostly start a Sneakers worker project by doing a <code>bundle gem my_worker</code> and then including Sneakers into the <code>gemspec</code>.</p>

<p>Sneakers packs the shell and logic aspects as a singular project, which is good for most if not all use cases.
You can include your operational concerns within it, as well as your message handling logic - no harm done.</p>

<p>If you find you need that extra-degree of separation, Sneakers makes it very easy to take apart your worker project into 2
separate projects as discussed above.</p>

<h4 id="testing">Testing</h4>

<p>Testing a system which depends on a real queue can be nasty (much like testing against a real database).</p>

<p>However with this layout it becomes easy and manageable:</p>

<ol>
  <li>Unit testing, simple - because <code>AcmeCorp::Handler</code> is a simple Ruby project.</li>
  <li>Integration testing / acceptance testing - focused within the Shell Project, you can do all of the typical 'dirty' test-harness tricks there.</li>
</ol>

<h4 id="the-price-modular-messaging">The Price: Modular Messaging</h4>

<p>Getting these immense gains from such an architecture, comes at a price of making sure the architecture supports modular messaging.</p>

<p>Plainly spoken, you will need to be sure a message is self-contained which means you can't just send off an ID of an item in the database;
you'll have to send off the entire object.</p>


    </main>
    <aside class="blog-aside">
      Want to be featured here?<br/>
      <a href="https://github.com/jondot/sneakers.io" >Submit a pull request</a>
      
      <h4>Recent Articles</h4>
      <ol class="blog-recent">
        <li>
          <a href="../../../2015/05/18/handling-failures-with-maxretry-handler.html">Handling failures with maxretry handler</a>
        </li>
        <li>
          <a href="../10/the-new-website.html">Sneakers 1.0 - The New Website</a>
        </li>
        <li>
          <a href="../09/monitoring-sneakers.html">Monitoring Sneakers</a>
        </li>
        <li>
          <a href="modular-workers.html">Modular Workers for Easier Testing and Development</a>
        </li>
        <li>
          <a href="../../11/21/what-weve-been-through.html">What We've Been Trough</a>
        </li>
      </ol>
      <hr />
      <h4>Tags</h4>
      <ol>
      </ol>
      <h4>By Year</h4>
      <ol>
      <li><a href="../../../2015.html">2015 (1)</a></li>
      <li><a href="../../../2014.html">2014 (4)</a></li>
      </ol>
      <div class="blog-minihero">
        <hr />
        <ul class="blog-socials">
          <li>
            <a href="http://twitter.com/jondot"><i class="fa fa-twitter"></i></a>
          </li>
          <li>
            <a href="https://github.com/jondot/sneakers"><i class="fa fa-github"></i></a>
          </li>
          <li>
            <a href="/sneakers/blog/feed.xml"><i class="fa fa-rss"></i></a>
          </li>
        </ul>
      </div>
    </aside>
  </div>
  <footer class="footer">
  <div class="footer-logo">
  </div>
  <div class="footer-links">
    <ul>
      <li><h3>Learn</h3></li>
      <li><a href="https://github.com/jondot/sneakers/wiki">Docs</a></li>
      <li><a href="http://sneakers.io/blog">Blog</a></li>
    </ul>
    <ul>
      <li><h3>Follow</h3></li>
      <li><a href="https://github.com/jondot/sneakers">Github</a></li>
      <li><a href="http://twitter.com/jondot">Follow @jondot</a></li>
      <li><a href="mailto:jondotan@gmail.com">Say hi :)</a></li>
    </ul>
    <ul>
      <li><h3>Community</h3></li>
      <li><a href="https://github.com/jondot/sneakers/issues">Issues</a></li>
      <li><a href="https://github.com/jondot/sneakers#contributing">How to Contribute</a></li>
      <li><a href="https://github.com/jondot/sneakers/wiki">Getting Help</a></li>
    </ul>
  </div>
  <p>
  Copyright Â© 2015 Dotan Nahum and contributors - Licensed under MIT.
  </p>
</footer>



  <script>
      (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
      function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
      e=o.createElement(i);r=o.getElementsByTagName(i)[0];
      e.src='//www.google-analytics.com/analytics.js';
      r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
      ga('create','UA-7131053-14');ga('send','pageview');
  </script>
</body>
</html>
